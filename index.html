<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–¢—Ä–µ–∫–µ—Ä –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–æ–≥–æ –≥–æ–ª–æ–¥–∞–Ω–∏—è</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      background-color: #e6f9f2;
      color: #333;
      line-height: 1.6;
    }

    header {
      background-color: #4caf50;
      color: white;
      padding: 1rem;
      text-align: center;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
      max-width: 900px;
      margin: 0 auto;
    }

    .article {
      background: white;
      padding: 1.5rem 2rem;
      border-radius: 15px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 2rem;
      width: 100%;
    }

    .article h2 {
      margin-top: 0;
      color: #2e7d32;
    }

    .tracker {
      background: white;
      padding: 1.5rem;
      border-radius: 15px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      max-width: 400px;
      width: 100%;
      margin-bottom: 2rem;
    }

    .info-card {
      margin-top: 1rem;
      padding: 1rem;
      background: #f0fff8;
      border-radius: 10px;
    }

    button {
      padding: 0.7rem 1.2rem;
      margin: 0.5rem;
      border: none;
      border-radius: 8px;
      background-color: #4caf50;
      color: white;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.3s ease;
    }

    button:hover:not(:disabled) {
      background-color: #388e3c;
    }

    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    .history-container {
      display: none;
      background: white;
      padding: 1rem;
      border-radius: 12px;
      margin-top: 1rem;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    #timer {
      font-size: 2.5rem;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      margin: 1rem 0;
      color: #2e7d32;
    }

    .method-option {
      padding: 0.5rem;
      margin: 0.3rem 0;
      cursor: pointer;
      border-radius: 5px;
      transition: background-color 0.2s;
    }

    .method-option:hover {
      background-color: #e0f2e9;
    }

    .method-option.selected {
      background-color: #c8e6c9;
      font-weight: bold;
    }

    @media (max-width: 600px) {
      .tracker {
        margin: 1rem;
      }

      main {
        padding: 1rem 0.5rem;
      }

      .article {
        padding: 1rem 1rem;
      }

      #timer {
        font-size: 2rem;
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>–¢—Ä–µ–∫–µ—Ä –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–æ–≥–æ –≥–æ–ª–æ–¥–∞–Ω–∏—è</h1>
  </header>
  <main>
    <section class="article">
      <h2>–ß—Ç–æ —Ç–∞–∫–æ–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–æ–µ –≥–æ–ª–æ–¥–∞–Ω–∏–µ –∏ –∑–∞—á–µ–º –æ–Ω–æ –Ω—É–∂–Ω–æ?</h2>
      <p>
        –ò–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–æ–µ –≥–æ–ª–æ–¥–∞–Ω–∏–µ ‚Äî —ç—Ç–æ —Ä–µ–∂–∏–º –ø–∏—Ç–∞–Ω–∏—è, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –ø–µ—Ä–∏–æ–¥—ã –µ–¥—ã —á–µ—Ä–µ–¥—É—é—Ç—Å—è —Å –ø–µ—Ä–∏–æ–¥–∞–º–∏ –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–∫–∞–∑–∞ –æ—Ç
        –ø–∏—â–∏. –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –≤–µ—Å–∞, —É–ª—É—á—à–µ–Ω–∏—è –æ–±–º–µ–Ω–∞ –≤–µ—â–µ—Å—Ç–≤ –∏ –æ–±—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è.
      </p>
    </section>

    <div class="tracker">
      <h3>–í—ã–±–µ—Ä–∏ –º–µ—Ç–æ–¥:</h3>
      <div id="fastingMethods"></div>
      <div class="info-card" id="infoCards"></div>

      <h3>–¢–∞–π–º–µ—Ä:</h3>
      <div id="timer">00:00:00</div>
      <button id="startStopBtn">–ù–∞—á–∞—Ç—å –≥–æ–ª–æ–¥–∞–Ω–∏–µ</button>
      <button id="saveBtn" disabled>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Å—Å–∏—é</button>
    </div>

    <button onclick="toggleHistory()">üìú –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
    <div class="history-container" id="historyContainer">
      <h3>–ò—Å—Ç–æ—Ä–∏—è:</h3>
      <ul id="historyList"></ul>
      <canvas id="progressChart" width="300" height="200"></canvas>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const fastingMethods = [
      {id: '16-8', title: '16:8', fastingHours: 16, eatingHours: 8},
      {id: '18-6', title: '18:6', fastingHours: 18, eatingHours: 6},
      {id: '20-4', title: '20:4', fastingHours: 20, eatingHours: 4}
    ];

    let selectedMethod = null;
    let timerRunning = false;
    let fastingStartTime = null;
    let remainingTime = 0; // –î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
    let timerInterval;

    const fastingMethodsContainer = document.getElementById('fastingMethods');
    const infoCardsContainer = document.getElementById('infoCards');
    const timerEl = document.getElementById('timer');
    const startStopBtn = document.getElementById('startStopBtn');
    const saveBtn = document.getElementById('saveBtn');
    const historyContainer = document.getElementById('historyContainer');
    const historyList = document.getElementById('historyList');

    function renderMethods() {
      fastingMethodsContainer.innerHTML = '';
      fastingMethods.forEach(method => {
        const div = document.createElement('div');
        div.className = 'method-option' + (selectedMethod?.id === method.id ? ' selected' : '');
        div.textContent = method.title;
        div.onclick = () => {
          selectedMethod = method;
          renderMethods();
          updateInfoCards();
          saveBtn.disabled = true;
          resetTimer();
        };
        fastingMethodsContainer.appendChild(div);
      });
    }

    function updateInfoCards() {
      if (!selectedMethod) return;
      infoCardsContainer.innerHTML = `
        <h4>–í—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º: ${selectedMethod.title}</h4>
        <p><strong>–ì–æ–ª–æ–¥–∞–Ω–∏–µ:</strong> ${selectedMethod.fastingHours} —á–∞—Å–æ–≤</p>
        <p><strong>–û–∫–Ω–æ –ø–∏—Ç–∞–Ω–∏—è:</strong> ${selectedMethod.eatingHours} —á–∞—Å–æ–≤</p>
      `;
    }

    function resetTimer() {
      clearInterval(timerInterval);
      timerRunning = false;
      remainingTime = selectedMethod ? selectedMethod.fastingHours * 3600 : 0;
      timerEl.textContent = formatTime(remainingTime);
      startStopBtn.textContent = '–ù–∞—á–∞—Ç—å –≥–æ–ª–æ–¥–∞–Ω–∏–µ';
      saveBtn.disabled = true;
    }

    function startTimer() {
      if (!selectedMethod) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º –≥–æ–ª–æ–¥–∞–Ω–∏—è.');
        return;
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
      if (remainingTime <= 0) {
        remainingTime = selectedMethod.fastingHours * 3600;
      }

      fastingStartTime = Date.now();
      timerRunning = true;
      startStopBtn.textContent = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å';
      saveBtn.disabled = true;

      timerInterval = setInterval(() => {
        const elapsed = Math.floor((Date.now() - fastingStartTime) / 1000);
        remainingTime = Math.max(0, selectedMethod.fastingHours * 3600 - elapsed);
        timerEl.textContent = formatTime(remainingTime);

        // –ö–æ–≥–¥–∞ —Ç–∞–π–º–µ—Ä –¥–æ—Å—Ç–∏–≥–∞–µ—Ç 0
        if (remainingTime <= 0) {
          clearInterval(timerInterval);
          timerRunning = false;
          startStopBtn.textContent = '–ù–∞—á–∞—Ç—å –≥–æ–ª–æ–¥–∞–Ω–∏–µ';
          saveBtn.disabled = false;
        }
      }, 1000);
    }

    function stopTimer() {
      clearInterval(timerInterval);
      timerRunning = false;
      startStopBtn.textContent = '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
      saveBtn.disabled = false;
    }

    function saveSession() {
      if (!selectedMethod || remainingTime >= selectedMethod.fastingHours * 3600) return;

      const actualDuration = selectedMethod.fastingHours * 3600 - remainingTime;
      const history = loadHistory();
      history.push({
        method: selectedMethod.id,
        start: fastingStartTime,
        duration: actualDuration
      });
      saveHistory(history);
      renderHistory();
      updateChart();
      resetTimer();
    }

    function loadHistory() {
      return JSON.parse(localStorage.getItem('fastingHistory') || '[]');
    }

    function saveHistory(history) {
      localStorage.setItem('fastingHistory', JSON.stringify(history));
    }

    function renderHistory() {
      const history = loadHistory();
      historyList.innerHTML = '';
      history.slice(-10).reverse().forEach(entry => {
        const li = document.createElement('li');
        const method = fastingMethods.find(m => m.id === entry.method)?.title || entry.method;
        li.textContent = `${new Date(entry.start).toLocaleString()} ‚Äî ${Math.floor(entry.duration / 60)} –º–∏–Ω (${method})`;
        historyList.appendChild(li);
      });
    }

    function updateChart() {
      const history = loadHistory();
      const recent = history.slice(-7);
      const labels = recent.map(s => new Date(s.start).toLocaleDateString());
      const data = recent.map(s => Math.round(s.duration / 60));

      if (window.progressChart) {
        window.progressChart.data.labels = labels;
        window.progressChart.data.datasets[0].data = data;
        window.progressChart.update();
      } else {
        const ctx = document.getElementById('progressChart').getContext('2d');
        window.progressChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: '–ú–∏–Ω—É—Ç—ã –≥–æ–ª–æ–¥–∞–Ω–∏—è',
              data: data,
              backgroundColor: '#4caf50'
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      }
    }

    function formatTime(seconds) {
      const h = String(Math.floor(seconds / 3600)).padStart(2, '0');
      const m = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
      const s = String(seconds % 60).padStart(2, '0');
      return `${h}:${m}:${s}`;
    }

    function toggleHistory() {
      historyContainer.style.display = historyContainer.style.display === 'none' ? 'block' : 'none';
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    startStopBtn.onclick = () => timerRunning ? stopTimer() : startTimer();
    saveBtn.onclick = saveSession;
    renderMethods();
    renderHistory();
    updateChart();
  </script>
</body>

</html>